name: QA Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # Her gÃ¼n saat 09:00'da Ã§alÄ±ÅŸtÄ±r (UTC)
    - cron: '0 9 * * *'

jobs:
  ui-tests:
    name: UI Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run UI Smoke Tests
      run: |
        pytest ui_tests/tests/ -m "ui and smoke" -v --html=reports/ui-smoke-report.html --self-contained-html
    
    - name: Upload UI Test Report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: ui-test-report
        path: reports/ui-smoke-report.html

  api-tests:
    name: API Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run API Tests
      run: |
        pytest api_tests/tests/ -m "api" -v --html=reports/api-report.html --self-contained-html
    
    - name: Upload API Test Report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: api-test-report
        path: reports/api-report.html

  regression-tests:
    name: Regression Tests (Nightly)
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run All Regression Tests
      run: |
        pytest -m "regression" -v --html=reports/regression-report.html --self-contained-html
    
    - name: Upload Regression Report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: regression-report
        path: reports/regression-report.html

  test-summary:
    name: Test Summary
    runs-on: ubuntu-latest
    needs: [ui-tests, api-tests]
    if: always()
    
    steps:
    - name: Test Summary
      run: |
        echo "## Test Execution Summary" >> $GITHUB_STEP_SUMMARY
        echo "âœ… UI Tests completed" >> $GITHUB_STEP_SUMMARY
        echo "âœ… API Tests completed" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“Š Check artifacts for detailed reports" >> $GITHUB_STEP_SUMMARY
